@page "/"
@page "/login"

@layout LoginLayout
@using ScriptHaven.Components.Layout
@using System.ComponentModel.DataAnnotations

<div class="auth-shell">

    <div class="web">
        <div class="web-badge" aria-hidden="true">
            <img src="/images/logo.png"
                 alt="CodeQuest logo"
                 class="logo-img" />
        </div>
        <span class="web-name">CodeQuest</span>
    </div>

    <h1 class="title">Welcome back</h1>
    <p class="subtitle">Sign in to your account to continue</p>

    <div class="card">
        <EditForm Model="@model" OnValidSubmit="@OnSignIn" class="form">
            <DataAnnotationsValidator />
            <ValidationSummary class="validation" />

            <div class="field">
                <label class="label">Email</label>
                <div class="input-row">
                    <span class="icon" aria-hidden="true">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16v12H4V6Z" stroke="currentColor" stroke-width="2" />
                            <path d="m4 7 8 6 8-6" stroke="currentColor" stroke-width="2" />
                        </svg>
                    </span>
                    <InputText class="input" @bind-Value="model.Email" placeholder="you@example.com" />
                </div>
                <ValidationMessage For="@(() => model.Email)" class="field-error" />
            </div>

            <div class="field">
                <label class="label">Password</label>
                <div class="input-row">
                    <span class="icon" aria-hidden="true">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                            <path d="M7 11V8a5 5 0 0 1 10 0v3" stroke="currentColor" stroke-width="2" />
                            <path d="M6 11h12v10H6V11Z" stroke="currentColor" stroke-width="2" />
                        </svg>
                    </span>

                    <InputText class="input"
                               type="@(showPassword ? "text" : "password")"
                               @bind-Value="model.Password"
                               placeholder="••••••••" />

                    <button type="button" class="ghost" @onclick="TogglePassword" aria-label="Toggle password">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                            <path d="M2 12s4-7 10-7 10 7 10 7-4 7-10 7S2 12 2 12Z" stroke="currentColor" stroke-width="2" />
                            <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" stroke="currentColor" stroke-width="2" />
                        </svg>
                    </button>
                </div>
                <ValidationMessage For="@(() => model.Password)" class="field-error" />
            </div>

            <button type="submit" class="btn">
                Sign in <span class="arrow" aria-hidden="true">→</span>
            </button>

            <div class="bottom">
                <span>Don't have an account?</span>
                <a href="/register" class="link">Create one</a>
            </div>
        </EditForm>
    </div>

</div>

@code {
    private readonly LoginModel model = new();
    private bool showPassword;

    private void TogglePassword() => showPassword = !showPassword;
    private Task OnSignIn() => Task.CompletedTask;

    public class LoginModel
    {
        [Required]
        [EmailAddress]
        public string Email { get; set; } = "";

        [Required]
        [MinLength(6)]
        public string Password { get; set; } = "";
    }
}
